<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stoplight Game - Traffic Light Edition</title>
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      background: linear-gradient(180deg, #fafafa, #eaeaea);
      padding: 20px;
      color: #333;
    }

    h1 {
      margin: 10px;
      font-weight: 600;
    }

    p {
      margin-top: 0;
      color: #555;
      font-size: 1em;
    }

    #game-board {
      display: grid;
      grid-template-columns: repeat(3, 90px);
      gap: 20px;
      margin: 20px;
    }

    /* Traffic light container */
    .traffic-light {
      width: 70px;
      height: 190px;
      background: #444;
      border-radius: 8px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.25);
      transition: transform 0.15s ease;
    }

    .traffic-light:hover {
      transform: scale(1.04);
      cursor: pointer;
    }

    /* Circles inside traffic light */
    .light {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: #888;
      box-shadow: inset 0 0 4px rgba(0,0,0,0.4);
      transition: background 0.3s;
    }

    .green { background: #4CAF50; }
    .yellow { background: #FFC107; }
    .red { background: #E53935; }

    #status {
      font-size: 1.1em;
      font-weight: 500;
      margin-top: 10px;
      min-height: 30px;
      padding: 6px 12px;
      border-radius: 6px;
      background: #f9f9f9;
      border: 1px solid #ccc;
    }

    button {
      padding: 8px 16px;
      font-size: 0.95em;
      cursor: pointer;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #f2f2f2;
      margin-top: 15px;
      transition: background 0.2s;
    }

    button:hover {
      background: #e0e0e0;
    }

    /* Nash equilibrium explanation box */
    #explanation {
      max-width: 600px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
      box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
      line-height: 1.4;
      font-size: 0.9em;
      color: #444;
    }

    #explanation h3 {
      margin-top: 0;
      font-size: 1.05em;
    }
  </style>
</head>
<body>
  <h1>Stoplight Game</h1>
  <p>Click to cycle through Green → Yellow → Red. Whoever turns Red loses.</p>
  <div id="status">Your Turn</div>
  <div id="game-board"></div>
  <button id="restart-button">Restart Game</button>

  <div id="explanation">
    <h3>Game Theory Insight</h3>
    <p>
      This Stoplight Game demonstrates a <b>Nash Equilibrium</b>. 
      The rational strategy for both players is to move safely from Green → Yellow, but avoid turning Red. 
      If one player deviates and clicks Red, they immediately lose, making “stop at Yellow” a stable and self-enforcing strategy.
    </p>
  </div>

  <script>
    const board = document.getElementById("game-board");
    const status = document.getElementById("status");
    const restartBtn = document.getElementById("restart-button");

    let gameOver = false;
    let playerTurn = true;

    // Initialize board with 3x3 traffic lights
    function initBoard() {
      board.innerHTML = "";
      gameOver = false;
      playerTurn = true;
      status.textContent = "Your Turn";
      status.style.borderColor = "#ccc";

      for (let i = 0; i < 9; i++) {
        const lightBox = document.createElement("div");
        lightBox.classList.add("traffic-light");
        lightBox.dataset.state = "green";

        // Create 3 circles: red, yellow, green
        const red = document.createElement("div");
        red.classList.add("light");
        const yellow = document.createElement("div");
        yellow.classList.add("light");
        const green = document.createElement("div");
        green.classList.add("light", "green"); // start as active green

        lightBox.appendChild(red);
        lightBox.appendChild(yellow);
        lightBox.appendChild(green);

        lightBox.addEventListener("click", () => handleMove(lightBox, true));
        board.appendChild(lightBox);
      }
    }

    // Update the traffic light to a new state
    function updateTrafficLight(lightBox, state) {
      const [red, yellow, green] = lightBox.children;
      red.className = "light";
      yellow.className = "light";
      green.className = "light";
      if (state === "green") green.classList.add("light", "green");
      if (state === "yellow") yellow.classList.add("light", "yellow");
      if (state === "red") red.classList.add("light", "red");
      lightBox.dataset.state = state;
    }

    function handleMove(lightBox, isHuman) {
      if (gameOver) return;
      let state = lightBox.dataset.state;

      if (state === "red") return; // can't play on red

      if (state === "green") {
        updateTrafficLight(lightBox, "yellow");
      } else if (state === "yellow") {
        updateTrafficLight(lightBox, "red");
        gameOver = true;
        status.textContent = isHuman ? "You clicked Red — You Lose!" : "Computer clicked Red — You Win!";
        status.style.borderColor = isHuman ? "#E53935" : "#4CAF50";
        return;
      }

      playerTurn = !playerTurn;
      if (!playerTurn) {
        status.textContent = "Computer's Turn...";
        setTimeout(computerMove, 900);
      } else {
        status.textContent = "Your Turn";
      }
    }

    // Computer plays randomly
    function computerMove() {
      if (gameOver) return;
      const lights = Array.from(document.querySelectorAll(".traffic-light"));
      const available = lights.filter(l => l.dataset.state !== "red");
      if (available.length === 0) return;

      const choice = available[Math.floor(Math.random() * available.length)];
      handleMove(choice, false);
    }

    restartBtn.addEventListener("click", initBoard);
    initBoard();
  </script>
      <!-- Q6: Event Tracker  -->
  <script>
    (function () {
      'use strict';

      // Helper: get timestamp
      function getTimestamp() {
        return new Date().toISOString().replace('T', ' ').substring(0, 19);
      }

      // Helper: detect element type
      function getElementType(el) {
        if (!el) return 'unknown';
        const tag = el.tagName.toLowerCase();

        if (tag === 'button') return 'button';
        if (tag === 'a') return 'link';
        if (tag === 'img') return 'image';
        if (tag === 'select' || tag === 'option') return 'dropdown';
        if (tag === 'input' && el.type === 'text') return 'text_input';
        if (tag === 'input') return el.type + '_input';
        if (tag === 'p' || tag === 'span' || tag === 'div') return 'text';
        return tag;
      }

      // Log page view on load
      window.addEventListener('load', function () {
        console.log({
          timestamp: getTimestamp(),
          type_of_event: 'page_view',
          event_object: 'page',
          page_url: window.location.href
        });
      });

      // Log clicks
      document.addEventListener('click', function (e) {
        const el = e.target;
        console.log({
          timestamp: getTimestamp(),
          type_of_event: 'click',
          event_object: getElementType(el),
          element_text: (el.innerText || '').trim().substring(0, 30) // short label if any
        });
      });
    })();
  </script>

</body>
</html>
